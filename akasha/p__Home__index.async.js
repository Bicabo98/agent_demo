"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{91981:function(Sa,rt,o){o.r(rt),o.d(rt,{default:function(){return Xn}});var Yt=o(64599),it=o.n(Yt),Qt=o(19632),he=o.n(Qt),qt=o(9783),q=o.n(qt),_t=o(97857),y=o.n(_t),en=o(5574),Z=o.n(en),tn=o(90930),nn={ModelFlow:"ModelFlow___jqrLp","lf-graph":"lf-graph___NT6sP","ant-card-grid":"ant-card-grid___vhW2g"},c=o(67294),ye=o(32590),an=o(62841),rn=o.n(an),on=o(12444),Ie=o.n(on),sn=o(72004),Ae=o.n(sn),ln=o(28785),pe=o.n(ln),dn=o(48374),ve=o.n(dn),un=o(31996),Oe=o.n(un),cn=o(26037),ze=o.n(cn),Ue=o(47321),ot=o(88773),e=o(85893),fn=function(){return(0,e.jsxs)("div",{className:"start-node",style:{width:"140px",height:"48px",background:"linear-gradient(135deg, #1890ff 0%, #36cfc9 100%)",boxShadow:`
          0 4px 12px rgba(0, 0, 0, 0.1),
          inset 0 -2px 6px rgba(255, 255, 255, 0.2),
          inset 0 2px 6px rgba(255, 255, 255, 0.1)
        `,borderRadius:"24px",border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",overflow:"hidden"},children:[(0,e.jsx)("div",{style:{position:"absolute",top:0,left:"-50%",width:"200%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)",transform:"translateX(-100%)",animation:"shimmer 3s infinite"}}),(0,e.jsx)("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px"},children:(0,e.jsx)("span",{style:{color:"#ffffff",fontSize:"15px",fontWeight:600,textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",letterSpacing:"0.5px"}})}),(0,e.jsx)("style",{children:`
          @keyframes shimmer {
            0% {
              transform: translateX(-100%);
            }
            50% {
              transform: translateX(100%);
            }
            100% {
              transform: translateX(100%);
            }
          }
          
          .start-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15),
                       inset 0 -2px 6px rgba(255, 255, 255, 0.3),
                       inset 0 2px 6px rgba(255, 255, 255, 0.2);
          }
          
          .start-node:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1),
                       inset 0 -1px 4px rgba(255, 255, 255, 0.2),
                       inset 0 1px 4px rgba(255, 255, 255, 0.1);
          }
        `})]})},hn=fn;function pn(B){var u=function(n){Oe()(r,n);var s=ze()(r);function r(){return Ie()(this,r),s.apply(this,arguments)}return Ae()(r,[{key:"createId",value:function(){return(0,ot.Z)().replace(/-/g,"")}},{key:"getDefaultAnchor",value:function(){var l=this.id,p=this.x,C=this.y,N=this.width,x=[];return x.push({x:p+N/2,y:C,id:"start_outgoing",type:"outgoing"}),x}},{key:"initNodeData",value:function(l){pe()(ve()(r.prototype),"initNodeData",this).call(this,l);var p=140,C=48;this.width=p,this.height=C,this.radius=8,this.anchorsOffset=[[p/2,0]],this.sourceRules=[{validate:function(x){return x.id===l.id},message:"\u8D77\u59CB\u8282\u70B9\u53EA\u80FD\u4F5C\u4E3A\u5F00\u59CB"}]}}]),r}(ye.Bm8);(0,Ue.z2)({type:"start",component:hn,model:u},B)}var Ye=new Set,ja=function(u){console.log("\u8BBE\u7F6E\u65B0\u8282\u70B9ID:",u),Ye.add(u)},Ca=function(u){console.log("\u6E05\u9664\u65B0\u8282\u70B9ID:",u),Ye.delete(u)},vn=function(u){var n,s,r,i=(0,c.useState)(!1),l=Z()(i,2),p=l[0],C=l[1],N=((n=u.model)===null||n===void 0||(n=n.text)===null||n===void 0?void 0:n.value)||((s=u.properties)===null||s===void 0?void 0:s.name)||"",x=((r=u.model)===null||r===void 0?void 0:r.id)||"",M=Ye.has(x);return console.log("\u8282\u70B9 ".concat(x," \u6E32\u67D3, \u662F\u5426\u4E3A\u65B0\u8282\u70B9: ").concat(M)),(0,c.useEffect)(function(){if(M){C(!0);var W=setTimeout(function(){C(!1)},6e5);return function(){return clearTimeout(W)}}},[M]),(0,e.jsxs)("div",{className:"child-node",style:{width:"140px",height:"48px",background:M?"#ffffff":"linear-gradient(135deg, #13c2c2 0%, #36cfc9 100%)",boxShadow:M?`0 4px 12px rgba(0, 0, 0, 0.1),
             inset 0 -2px 6px rgba(0, 0, 0, 0.02),
             inset 0 2px 6px rgba(0, 0, 0, 0.02)`:`0 3px 10px rgba(19, 194, 194, 0.2),
             inset 0 -1px 4px rgba(255, 255, 255, 0.1),
             inset 0 1px 4px rgba(255, 255, 255, 0.1)`,borderRadius:"24px",border:M?"1px solid rgba(0, 0, 0, 0.1)":"1px solid rgba(255, 255, 255, 0.2)",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",overflow:"hidden"},children:[!M&&(0,e.jsx)("div",{style:{position:"absolute",top:0,left:"-50%",width:"200%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)",transform:"translateX(-100%)",animation:"shimmer 3s infinite"}}),(0,e.jsx)("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"8px",zIndex:2},children:(0,e.jsxs)("span",{style:{color:M?"#333333":"#ffffff",fontSize:"15px",fontWeight:500,textShadow:M?"none":"0 1px 2px rgba(0, 0, 0, 0.15)",letterSpacing:"0.5px"},children:[N,p&&(0,e.jsx)("span",{style:{display:"inline-block",marginLeft:"4px",animation:"rotate 1.5s linear infinite"},children:"\u{1F504}"})]})}),(0,e.jsx)("style",{children:`
          @keyframes shimmer {
            0% {
              transform: translateX(-100%);
            }
            50% {
              transform: translateX(100%);
            }
            100% {
              transform: translateX(100%);
            }
          }
          
          @keyframes rotate {
            from {
              transform: rotate(0deg);
            }
            to {
              transform: rotate(360deg);
            }
          }
          
          .child-node:hover {
            transform: translateY(-2px);
            box-shadow: `.concat(M?"0 6px 16px rgba(0, 0, 0, 0.12), inset 0 -2px 6px rgba(0, 0, 0, 0.02), inset 0 2px 6px rgba(0, 0, 0, 0.02)":"0 6px 16px rgba(19, 194, 194, 0.25), inset 0 -2px 6px rgba(255, 255, 255, 0.3), inset 0 2px 6px rgba(255, 255, 255, 0.2)",`;
          }
          
          .child-node:active {
            transform: translateY(1px);
            box-shadow: `).concat(M?"0 2px 8px rgba(0, 0, 0, 0.08), inset 0 -1px 4px rgba(0, 0, 0, 0.02), inset 0 1px 4px rgba(0, 0, 0, 0.02)":"0 2px 8px rgba(19, 194, 194, 0.15), inset 0 -1px 4px rgba(255, 255, 255, 0.2), inset 0 1px 4px rgba(255, 255, 255, 0.1)",`;
          }
        `)})]})},xn=vn,xe={},st=function(u,n){console.log("\u8BBE\u7F6E\u8282\u70B9 ".concat(u," \u7684\u72B6\u6001:"),n),xe[u]=y()(y()({},xe[u]||{isNewNode:!1}),n),console.log("\u8BBE\u7F6E\u540E\u7684\u72B6\u6001\u5B58\u50A8:",xe)},Na=function(u){return console.log("\u83B7\u53D6\u8282\u70B9 ".concat(u," \u7684\u72B6\u6001, \u5F53\u524D\u5B58\u50A8:"),xe),xe[u]||{isNewNode:!1}},Da=function(){return Object.values(xe).some(function(u){return u.isNewNode})},wa=function(){for(var u=0,n=Object.entries(xe);u<n.length;u++){var s=_slicedToArray(n[u],2),r=s[0],i=s[1];if(i.isNewNode)return r}return null},Ia=null,Aa=o(21588),Ba=o(99316);function gn(B){var u=function(n){Oe()(r,n);var s=ze()(r);function r(){return Ie()(this,r),s.apply(this,arguments)}return Ae()(r,[{key:"createId",value:function(){return(0,ot.Z)().replace(/-/g,"")}},{key:"getDefaultAnchor",value:function(){var l=this.id,p=this.x,C=this.y,N=this.width,x=[];return x.push({x:p+N/2,y:C,id:"start_outgoing",type:"outgoing"}),x}},{key:"initNodeData",value:function(l){var p;pe()(ve()(r.prototype),"initNodeData",this).call(this,l);var C=140,N=48;this.width=C,this.height=N,this.radius=8,this.anchorsOffset=[[C/2,0],[-C/2,0]],this.sourceRules=[{validate:function(W){return!0},message:"\u5B50\u8282\u70B9"}],console.log("Node initNodeData received:",JSON.stringify(l,null,2)),this.properties||(this.properties={});var x=(p=l.properties)===null||p===void 0?void 0:p.isNewNode;console.log("\u8282\u70B9 ".concat(this.id," \u521D\u59CB\u5316, isNewNode="),x),this.setProperties(y()(y()({},this.properties),{},{isNewNode:x,style:x?{fill:"#ffffff",stroke:"#ffffff",strokeWidth:3,radius:8}:{fill:"#ffffff",stroke:"#ffffff",strokeWidth:2,radius:8}})),console.log("\u66F4\u65B0\u72B6\u6001\u5B58\u50A8, \u8282\u70B9ID=".concat(this.id,", isNewNode=").concat(x)),st(this.id,{isNewNode:!!x})}},{key:"updateTrainingStatus",value:function(l){return console.log("\u66F4\u65B0\u8282\u70B9 ".concat(this.id," \u7684\u8BAD\u7EC3\u72B6\u6001, isTraining="),l),this.setProperties(y()(y()({},this.properties),{},{isNewNode:l,style:l?{fill:"#ffffff",stroke:"#ffffff",strokeWidth:3,radius:8}:{fill:"#ffffff",stroke:"#ffffff",strokeWidth:2,radius:8}})),console.log("\u66F4\u65B0\u72B6\u6001\u5B58\u50A8, \u8282\u70B9ID=".concat(this.id,", isNewNode=").concat(l)),st(this.id,{isNewNode:l}),this}},{key:"getIsNewNode",value:function(){var l;return((l=this.properties)===null||l===void 0?void 0:l.isNewNode)||!1}}]),r}(ye.Bm8);(0,Ue.z2)({type:"assignment",component:xn,model:u},B)}var mn=function(B){Oe()(n,B);var u=ze()(n);function n(){return Ie()(this,n),u.apply(this,arguments)}return Ae()(n,[{key:"getEdgeStyle",value:function(){var r=pe()(ve()(n.prototype),"getEdgeStyle",this).call(this);return r.stroke="#13c2c2",r.strokeWidth=2,r.strokeDasharray="3 2",r}},{key:"getTextStyle",value:function(){var r=pe()(ve()(n.prototype),"getTextStyle",this).call(this);return r.color="#13c2c2",r.fontSize=12,r.background={fill:"#f5f5f5"},r}},{key:"initEdgeData",value:function(r){pe()(ve()(n.prototype),"initEdgeData",this).call(this,r),this.sourceAnchorId=r.sourceAnchorId,this.targetAnchorId=r.targetAnchorId,this.arrowConfig={markerEnd:"arrow",markerStart:""}}},{key:"getArrowStyle",value:function(){var r=pe()(ve()(n.prototype),"getArrowStyle",this).call(this);return r.stroke="#13c2c2",r.fill="#13c2c2",r}}]),n}(ye.bU9),yn={type:"myBezier",view:ye.Jdm,model:mn},bn=o(2473),lt=function(){function B(){Ie()(this,B),q()(this,"lf",void 0),q()(this,"option",void 0)}return Ae()(B,[{key:"render",value:function(n){this.lf=n}},{key:"layout",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.lf.graphModel,r=s.nodes,i=s.edges,l=s.gridSize,p=l>20?l*2:40,C=l>20?l*2:40;this.option=y()({type:"dagre",rankdir:"LR",align:"DR",nodesep:p,ranksep:C,begin:[200,200]},n);var N=new bn.Vq(this.option),x=N.layout({nodes:r.map(function(W){return y()(y()({},W),{},{id:W.id,size:{width:W.width,height:W.height},model:W})}),edges:i.map(function(W){return y()(y()({},W),{},{source:W.sourceNodeId,target:W.targetNodeId,model:W})})}),M=this.processLayoutData(x);this.lf.clearData(),this.lf.render(M)}},{key:"processLayoutData",value:function(n){var s,r,i=this,l={nodes:[],edges:[]};return n==null||(s=n.nodes)===null||s===void 0||s.forEach(function(p){var C=p.model,N=p.x,x=p.y,M=y()(y()({},C.getData()),{},{x:N,y:x});M.text&&(M.text.x=N,M.text.y=x),l.nodes.push(M)}),n==null||(r=n.edges)===null||r===void 0||r.forEach(function(p){var C=p.model,N=C.getData();N.pointsList=i.calcPointsList(C,l.nodes),i.updateEdgeData(N),l.edges.push(N)}),l}},{key:"updateEdgeData",value:function(n){if(n.pointsList&&n.pointsList.length>=2){var s=[n.pointsList[0],n.pointsList[n.pointsList.length-1]],r=s[0],i=s[1];n.startPoint={x:r.x,y:r.y},n.endPoint={x:i.x,y:i.y}}else n.startPoint=n.endPoint=void 0}},{key:"pointFilter",value:function(n){return n.filter(function(s,r,i){if(r===0||r===i.length-1)return!0;var l=i[r-1],p=i[r+1];return!(l.x===s.x&&s.x===p.x)&&!(l.y===s.y&&s.y===p.y)})}},{key:"calcPointsList",value:function(n,s){var r;if(!((this===null||this===void 0||(r=this.option)===null||r===void 0?void 0:r.rankdir)!=="LR"||(n==null?void 0:n.modelType)!=="polyline-edge")){var i=s.find(function(N){return N.id===n.sourceNodeId}),l=s.find(function(N){return N.id===n.targetNodeId});if(!(!i||!l)){var p={x:i.x,y:i.y},C={x:l.x,y:l.y};return this.pointFilter([p,C])}}}}]),B}();q()(lt,"pluginName","dagre");var L=o(26412),dt=o(68872),Qe=o(4393),ne=o(21387),Sn=o(71230),ut=o(15746),D=o(87682),ct=o(71971),ft=o(41730),ht=o(97937),pt=o(99611),jn=o(57619),Cn=o(29009),Nn=o(48088),Dn=o(34816),wn=o(43815),In=o(26050),An=function(u){var n,s=((n=u.model)===null||n===void 0||(n=n.text)===null||n===void 0?void 0:n.value)||"",r=s,i="";if(s.includes(`
`)){var l=s.split(`
`);r=l[0],i=l[1]||""}return(0,e.jsxs)("div",{className:"new-white-node",style:{width:"140px",height:i?"70px":"48px",background:"#ffffff",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1), inset 0 -2px 6px rgba(0, 0, 0, 0.02), inset 0 2px 6px rgba(0, 0, 0, 0.02)",borderRadius:"24px",border:"1px solid rgba(0, 0, 0, 0.1)",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",padding:"8px 12px",boxSizing:"border-box"},children:[(0,e.jsx)("div",{style:{width:"100%",textAlign:"center",flex:"1",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,e.jsx)("span",{style:{color:"#333333",fontSize:"15px",fontWeight:500,letterSpacing:"0.5px"},children:r})}),i&&(0,e.jsxs)("div",{style:{width:"100%",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",gap:"4px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"8px",padding:"2px 6px",marginTop:"4px"},children:[(0,e.jsx)("span",{className:"rotating-icon",style:{display:"inline-block",animation:"rotate 1.5s linear infinite",fontSize:"10px"},children:"\u{1F504}"}),(0,e.jsx)("span",{style:{color:"#666666",fontSize:"10px",fontWeight:400},children:i})]}),(0,e.jsx)("style",{children:`
          @keyframes rotate {
            from {
              transform: rotate(0deg);
            }
            to {
              transform: rotate(360deg);
            }
          }
          
          .new-white-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), inset 0 -2px 6px rgba(0, 0, 0, 0.02), inset 0 2px 6px rgba(0, 0, 0, 0.02);
          }
          
          .new-white-node:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), inset 0 -1px 4px rgba(0, 0, 0, 0.02), inset 0 1px 4px rgba(0, 0, 0, 0.02);
          }
        `})]})},Bn=An;function Mn(B){var u=function(n){Oe()(r,n);var s=ze()(r);function r(){return Ie()(this,r),s.apply(this,arguments)}return Ae()(r,[{key:"getDefaultAnchor",value:function(){var l=this.id,p=this.x,C=this.y,N=this.width,x=[];return x.push({x:p+N/2,y:C,id:"start_outgoing",type:"outgoing"}),x}},{key:"initNodeData",value:function(l){var p;pe()(ve()(r.prototype),"initNodeData",this).call(this,l);var C=140,N=((p=l.text)===null||p===void 0?void 0:p.value)||"",x=N.includes(`
`),M=x?70:48;return this.width=C,this.height=M,this.radius=8,this.anchorsOffset=[[C/2,0],[-C/2,0]],this.sourceRules=[{validate:function(be){return!0},message:"\u65B0\u8282\u70B9"}],this}},{key:"getText",value:function(){var l=this.text.value;return{value:l,x:this.x,y:this.y}}}]),r}(ye.Bm8);(0,Ue.z2)({type:"new-white-node",component:Bn,model:u},B)}var Tn=o(15009),Re=o.n(Tn),En=o(99289),vt=o.n(En),Pn=o(68400),Be=o.n(Pn),xt=o(27406),gt=o(7134),Zn=o(27496),Me=o(45688),mt,yt,bt,St,jt,kn=Me.ZP.div(mt||(mt=Be()([`
  display: flex;
  flex-direction: column;
  height: 400px;
  width: 600;
  background-color: #f5f5f5;
`]))),On=Me.ZP.div(yt||(yt=Be()([`
  flex: 1;
  overflow-y: auto;
  padding: 10px;
`]))),zn=Me.ZP.div(bt||(bt=Be()([`
  display: flex;
  padding: 10px;
  background-color: #fff;
`]))),Rn=(0,Me.ZP)(ct.Z)(St||(St=Be()([`
  flex: 1;
  margin-right: 10px;
`]))),Ln=Me.ZP.div(jt||(jt=Be()([`
  max-width: 80%;
  padding: 8px 12px;
  margin-bottom: 10px;
  background-color: `,`;
  color: #000000;
  border-radius: 8px;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: 12px;
    width: 0;
    height: 0;
    border: 6px solid transparent;
    `,`
  }
`])),function(B){return B.isMine?"#95ec69":"#ffffff"},function(B){return B.isMine?`right: -5px;
         border-left-color: #95ec69;
         border-right: 0;`:`left: -5px;
         border-right-color: #ffffff;
         border-left: 0;`}),_={},Wn=function(u){var n,s=u.nodeData,r=(0,c.useState)(function(){var O,I=s==null||(O=s.nodeData)===null||O===void 0?void 0:O.name;return _[I]||(_[I]=[]),_[I]}),i=Z()(r,2),l=i[0],p=i[1];(0,c.useEffect)(function(){var O,I=s==null||(O=s.nodeData)===null||O===void 0?void 0:O.name;_[I]||(_[I]=[]),p(_[I])},[s==null?void 0:s.name]);var C=(0,c.useState)(""),N=Z()(C,2),x=N[0],M=N[1],W=(0,c.useState)(null),be=Z()(W,2),Le=be[0],We=be[1],Te=(0,c.useRef)(null),Ve=(0,c.useRef)(null),a=function(){var O=vt()(Re()().mark(function I(){var oe,se,ee,ce,K,te,Ee,k;return Re()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(!x.trim()){re.next=16;break}return ee=s==null||(oe=s.nodeData)===null||oe===void 0?void 0:oe.name,_[ee]||(_[ee]=[]),ce={sender:"me",content:x.trim(),avatar:"/placeholder.svg?height=40&width=40"},K=[].concat(he()(_[ee]),[ce]),console.log("updatedMessages=",K),_[ee]=K,p(K),M(""),re.next=11,Se(x.trim(),Le);case 11:te=re.sent,console.log("response:",te),te.session_id&&We(te.session_id),te&&(Ee={sender:"other",content:te.message,avatar:"/placeholder.svg?height=40&width=40"},k=[].concat(he()(K),[Ee]),_[ee]=k,p(k)),(se=Te.current)===null||se===void 0||se.scrollIntoView({behavior:"smooth"});case 16:case"end":return re.stop()}},I)}));return function(){return O.apply(this,arguments)}}(),Se=function(){var O=vt()(Re()().mark(function I(oe,se){var ee,ce,K,te;return Re()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,ee="https://kol.teeml.ai/api/chat",ce={model_version:"akasha",text:oe},se&&(ce.session_id=se),k.next=6,fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ce)});case 6:if(K=k.sent,K.ok){k.next=9;break}throw new Error("HTTP error! Status: ".concat(K.status));case 9:return k.next=11,K.json();case 11:return te=k.sent,console.log("API response:",te),k.abrupt("return",te||null);case 16:return k.prev=16,k.t0=k.catch(0),console.error("Error calling chat API:",k.t0),k.abrupt("return",null);case 20:case"end":return k.stop()}},I,null,[[0,16]])}));return function(oe,se){return O.apply(this,arguments)}}(),_e=function(I){I.key==="Enter"&&a()};return(0,c.useEffect)(function(){requestAnimationFrame(function(){var O;(O=Te.current)===null||O===void 0||O.scrollIntoView({behavior:"smooth"})})},[l]),(0,e.jsxs)(kn,{children:[(0,e.jsxs)(On,{ref:Ve,children:[(0,e.jsx)(xt.Z,{itemLayout:"horizontal",dataSource:_[s==null||(n=s.nodeData)===null||n===void 0?void 0:n.name],locale:{emptyText:"No messages yet"},renderItem:function(I){return(0,e.jsxs)(xt.Z.Item,{style:{justifyContent:I.sender==="me"?"flex-end":"flex-start",border:"none",padding:"4px 0"},children:[I.sender!=="me"&&(0,e.jsx)(gt.C,{src:I.avatar,style:{marginRight:"8px"}}),(0,e.jsx)(Ln,{isMine:I.sender==="me",children:I.content}),I.sender==="me"&&(0,e.jsx)(gt.C,{src:I.avatar,style:{marginLeft:"8px"}})]})}}),(0,e.jsx)("div",{ref:Te})]}),(0,e.jsxs)(zn,{children:[(0,e.jsx)(Rn,{value:x,onChange:function(I){return M(I.target.value)},onKeyPress:_e,placeholder:"Input message..."}),(0,e.jsx)(ne.ZP,{type:"primary",icon:(0,e.jsx)(Zn.Z,{}),onClick:a,children:"Send"})]})]})},Vn=Wn,Fn=function(u){var n=u.show,s=u.onClose,r=(0,c.useState)(!1),i=Z()(r,2),l=i[0],p=i[1];(0,c.useEffect)(function(){p(n)},[n]);var C=function(){p(!1)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ft.Z,{title:"Chat",keyboard:!1,open:l,closable:!0,afterClose:function(){s()},onCancel:C,footer:null,width:600,children:(0,e.jsx)(Vn,{nodeData:u.data})})})},Gn=Fn,ue="Akasha Model",qe="Home Doctor",Hn="Family Doctor",Ma="Dentist",Ta="Cardiologist",Ct=["Cardiologist","Neurologist","Pediatrician","Surgeon","Dermatologist","Oncologist","Radiologist","Psychiatrist","Orthopedist","Ophthalmologist","Gynecologist","Urologist","Endocrinologist","Gastroenterologist","Pulmonologist","Nephrologist","Rheumatologist","Anesthesiologist","Pathologist","Hematologist","Immunologist","Geneticist","Internist","Dentist","Allergist","Nutritionist","Physiotherapist","Pharmacist","Epidemiologist","Virologist"],$n=function(){var u,n=(0,c.useRef)(null),s=rn()(null),r=Z()(s,3),i=r[0],l=r[1],p=r[2],C=(0,c.useState)({}),N=Z()(C,2),x=N[0],M=N[1],W=(0,c.useState)({showModel:!1,data:{}}),be=Z()(W,2),Le=be[0],We=be[1],Te=(0,c.useState)({}),Ve=Z()(Te,2),a=Ve[0],Se=Ve[1],_e=(0,c.useState)(!1),O=Z()(_e,2),I=O[0],oe=O[1],se=(0,c.useState)(!1),ee=Z()(se,2),ce=ee[0],K=ee[1],te={TotalModels:5,DataSets:4,LaunchedModels:3,Validator:10,Builder:4},Ee=(0,c.useState)({}),k=Z()(Ee,2),ae=k[0],re=k[1],Jn=(0,c.useState)({Based:40,ALGO:20,DATASET:20,Builder:10,Validator:10}),Nt=Z()(Jn,2),je=Nt[0],Ea=Nt[1],le=(0,c.useRef)(je),Kn=(0,c.useState)([]),Dt=Z()(Kn,2),ge=Dt[0],wt=Dt[1],Ce=(0,c.useRef)({}),Fe=(0,c.useRef)(5),Un=(0,c.useState)(!1),It=Z()(Un,2),Ge=It[0],et=It[1],Yn=(0,c.useState)(null),At=Z()(Yn,2),He=At[0],Qn=At[1],qn=(0,c.useState)(!1),Bt=Z()(qn,2),Ne=Bt[0],Mt=Bt[1],_n=(0,c.useState)({Based:{},Algo:{},Dataset:{},Builder:{},Validator:{}}),Tt=Z()(_n,2),F=Tt[0],Et=Tt[1],ea=(0,c.useState)(!1),Pt=Z()(ea,2),ta=Pt[0],tt=Pt[1],na=(0,c.useState)(""),Zt=Z()(na,2),kt=Zt[0],Ot=Zt[1],aa=(0,c.useState)(0),zt=Z()(aa,2),Pa=zt[0],ra=zt[1],ia=(0,c.useState)(""),Rt=Z()(ia,2),$e=Rt[0],Lt=Rt[1],Wt=function(){var t=Date.now().toString(),d=new Uint8Array(12);crypto.getRandomValues(d);var v=Array.from(d,function(j){return(j%10).toString()}).join("");return t+v},oa=(0,c.useState)([{nodeData:{nodeId:Wt(),name:ue}}]),Vt=Z()(oa,2),fe=Vt[0],sa=Vt[1],Xe=function(){return Math.floor(1e3+Math.random()*9e3)},nt=function(t){t!=null&&t.name||(t.name="");var d=function(b){var A=0,U=le.current.Based,P=le.current.DATASET;if(b===ue)return le.current;(b.startsWith(qe)||b.startsWith(Hn))&&(A=1,b.includes(".")&&(A=2));var T=A*5;return U=le.current.Based-T,P=le.current.DATASET+T,{Based:U,ALGO:le.current.ALGO,DATASET:P,Builder:le.current.Builder,Validator:le.current.Validator}},v=d(t.name),j={dataset:{id:"asdfasdfasdf",name:"clinical-data-50k",contributors:[{name:"Alice",rate:"10%"},{name:"Bob",rate:"50%"},{name:"Charlie",rate:"40%"}]},training:{id:"asdfasdfasdf",type:"SFT",author:"Bob",date:"2020-01-01",fingerPrint:"0xdc93112d09a205d1caa35b3756b227392176bee8a1afd03cff51c51cd6c3423f",accuracy:.8}},f=[{modelId:"",name:"".concat(t==null?void 0:t.name,".3"),rate:"15%",reward:"".concat(Xe())},{modelId:"",name:"".concat(t==null?void 0:t.name,".2"),rate:"15%",reward:"".concat(Xe())},{modelId:"",name:"".concat(t==null?void 0:t.name,".1"),rate:"20%",reward:"".concat(Xe())},{modelId:"",name:t==null?void 0:t.name,rate:"50%",reward:"".concat(Xe())}];return y()(y()({modelId:"",name:t==null?void 0:t.name,parentModel:(t==null?void 0:t.name)===ue?"":t!=null&&t.name.startsWith(qe)?qe:ue},j),{},{Incentives:f,contributions:v})},Ft=function(t){var d=[],v=[],j=function f(m){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,U=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,P=m.nodeData,T=m.children,E=P.nodeId,g=P.name,w=P.isNewNode,z="assignment";A===0?z="start":w===!0&&(z="new-white-node");var G={id:E,type:z,text:{value:g},properties:{name:g,isNewNode:!!w,rawData:m}};if(d.push(G),b){var S="edge-".concat(b,"-").concat(E),H={id:S,sourceNodeId:b,targetNodeId:E,type:"myBezier"};v.push(H)}T&&T.length>0&&T.forEach(function(V,$){f(V,E,A+1,$)})};return t.forEach(function(f,m){j(f,null,0,m)}),{nodes:d,edges:v}},la=function(){var t=0,d=function(j){t++};return fe.forEach(function(v){return d(v)}),Fe.current=t,t};(0,c.useEffect)(function(){var h=la();Fe.current=h,M(y()(y()({},te),{},{TotalModels:h}));var t={};fe.forEach(function(d){for(var v=[d];v.length>0;){var j=v.pop();t[j.nodeData.name]=nt(j.nodeData)}}),re(t),Se(t[ue])},[]),(0,c.useEffect)(function(){if(i){var h=Ft(fe),t=h.nodes,d=h.edges;i.render({nodes:t,edges:d}),i==null||i.extension.dagre.layout({nodesep:15,ranksep:35})}},[i,fe]);var da=function(t){var d=null,v=0,j=300;t.on("node:click",function(f){var m=Date.now();if(m-v<j){d&&(clearTimeout(d),d=null);return}d=setTimeout(function(){var b,A,U=f==null||(b=f.data)===null||b===void 0?void 0:b.id,P=f==null||(A=f.data)===null||A===void 0||(A=A.properties)===null||A===void 0||(A=A.rawData)===null||A===void 0||(A=A.nodeData)===null||A===void 0?void 0:A.name;if(P){Qn(U),console.log("\u6D4B\u8BD5\u70B9\u51FB1 =",ge);var T,E=ge.includes(P);if(P&&Ce.current[P])T=JSON.parse(JSON.stringify(Ce.current[P])),E&&(T.isManuallyModified=!0);else if(P&&ae[P])T=JSON.parse(JSON.stringify(ae[P])),E&&(T.isManuallyModified=!0);else{var g;T=nt(f==null||(g=f.data)===null||g===void 0||(g=g.properties)===null||g===void 0||(g=g.rawData)===null||g===void 0?void 0:g.nodeData);var w=y()(y()({},ae),{},q()({},P,T));Ce.current=w,re(w)}T.name||(T.name=P),Se(T),et(!0),d=null,v=m}},j)}),t.on("node:dbclick",function(f){var m;d&&(clearTimeout(d),d=null),We({showModel:!0,data:f==null||(m=f.data)===null||m===void 0||(m=m.properties)===null||m===void 0?void 0:m.rawData})})},ua=function(t){if(!(!t||!t.getGraphData)){var d=t.getGraphData();d.nodes.forEach(function(v){t.setProperties(v.id,{selected:!1})})}},ca=function(t,d){if(!(!t||!t.setProperties))try{t.setProperties(d,{selected:!0})}catch(v){console.error("highlight node failed",v)}};(0,c.useEffect)(function(){return function(){i&&He&&ua(i)}},[i,He]),(0,c.useEffect)(function(){i&&He&&setTimeout(function(){ca(i,He)},100)},[i,fe]),(0,c.useEffect)(function(){if(n!=null&&n.current){var h=new ye.cTU({container:n==null?void 0:n.current,isSilentMode:!0,grid:{size:10,visible:!1,config:{color:"#f5f5f5"}},background:{backgroundColor:"#f5f5f5"},textEdit:!1,autoResize:!0,plugins:[lt]});h.on("graph:rendered",function(){h.fitView(200)}),pn(h),gn(h),Mn(h),h.setDefaultEdgeType("myBezier"),h.register(yn),l(h),da(h)}return function(){if(p!=null&&p.current){var t;p==null||(t=p.current)===null||t===void 0||t.clearData()}}},[n==null?void 0:n.current]);var fa=function(t){var d,v,j,f,m,b={Based:"#5B8FF9",ALGO:"#5AD8A6",DATASET:"#5D7092",Builder:"#F6BD16",Validator:"#E8684A",ModelName:"#0056b3"};return(0,e.jsxs)(L.Z,{size:"small",column:1,children:[(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.ModelName},children:"Model Name"}),children:(0,e.jsx)("span",{style:{color:b.ModelName},children:t==null?void 0:t.name})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.Based},children:"Based"}),children:(0,e.jsxs)("span",{style:{color:b.Based},children:[t==null||(d=t.contributions)===null||d===void 0?void 0:d.Based,"%"]})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.ALGO},children:"ALGO"}),children:(0,e.jsxs)("span",{style:{color:b.ALGO},children:[t==null||(v=t.contributions)===null||v===void 0?void 0:v.ALGO,"%"]})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.DATASET},children:"DATASET"}),children:(0,e.jsxs)("span",{style:{color:b.DATASET},children:[t==null||(j=t.contributions)===null||j===void 0?void 0:j.DATASET,"%"]})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.Builder},children:"Builder"}),children:(0,e.jsxs)("span",{style:{color:b.Builder},children:[t==null||(f=t.contributions)===null||f===void 0?void 0:f.Builder,"%"]})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("span",{style:{color:b.Validator},children:"Validator"}),children:(0,e.jsxs)("span",{style:{color:b.Validator},children:[t==null||(m=t.contributions)===null||m===void 0?void 0:m.Validator,"%"]})})]})},ha=function(t){if(!t||!t.contributions)return console.log("No contributions data available"),null;var d=[{name:"Based",value:parseInt(t.contributions.Based,10)||0},{name:"ALGO",value:parseInt(t.contributions.ALGO,10)||0},{name:"DATASET",value:parseInt(t.contributions.DATASET,10)||0},{name:"Builder",value:parseInt(t.contributions.Builder,10)||0},{name:"Validator",value:parseInt(t.contributions.Validator,10)||0}],v={Based:"#5B8FF9",ALGO:"#5AD8A6",DATASET:"#5D7092",Builder:"#F6BD16",Validator:"#E8684A",ModelName:"#0056b3"},j=function(m){var b=m.cx,A=m.cy,U=m.midAngle,P=m.innerRadius,T=m.outerRadius,E=m.value,g=P+(T-P)*.5,w=b+g*Math.cos(-U*Math.PI/180),z=A+g*Math.sin(-U*Math.PI/180);return E<5?null:(0,e.jsx)("text",{x:w,y:z,fill:"white",textAnchor:"middle",dominantBaseline:"central",style:{fontWeight:"bold",fontSize:E>10?"16px":"12px",textShadow:"0px 0px 2px rgba(0,0,0,0.7)"},children:"".concat(E,"%")})};return(0,e.jsx)("div",{style:{width:"100%",height:300,display:"flex",justifyContent:"center"},children:(0,e.jsx)("div",{style:{width:"80%",height:"100%"},children:(0,e.jsx)(Cn.h,{width:"100%",height:"100%",children:(0,e.jsxs)(Nn.u,{children:[(0,e.jsx)(Dn.b,{data:d,cx:"50%",cy:"50%",labelLine:!1,label:j,outerRadius:90,innerRadius:45,fill:"#8884d8",dataKey:"value",paddingAngle:2,children:d.map(function(f,m){return(0,e.jsx)(wn.b,{fill:v[f.name]},"cell-".concat(m))})}),(0,e.jsx)(In.u,{formatter:function(m,b){return["".concat(m,"%"),b]}})]})})})})},pa=function(t){var d,v=((d=ae[t])===null||d===void 0?void 0:d.contributions)||{},j={Based:q()({},t,v.Based||0),Algo:q()({},t,v.ALGO||0),Dataset:q()({},t,v.DATASET||0),Builder:q()({},t,v.Builder||0),Validator:q()({},t,v.Validator||0)};Object.values(v).every(function(f){return!f})&&a!==null&&a!==void 0&&a.contributions&&(j.Based[t]=a.contributions.Based||0,j.Algo[t]=a.contributions.ALGO||0,j.Dataset[t]=a.contributions.DATASET||0,j.Builder[t]=a.contributions.Builder||0,j.Validator[t]=a.contributions.Validator||0),Et(j)},Gt=function(){if(!a){dt.ZP.error("nodeInfoData is empty");return}pa(a.name),K(!0)},at=(0,c.useRef)(null),Ht=function(){if(a!=null&&a.name){var t=y()(y()({},a),{},{contributions:{Based:F.Based[a.name]||0,ALGO:F.Algo[a.name]||0,DATASET:F.Dataset[a.name]||0,Builder:F.Builder[a.name]||0,Validator:F.Validator[a.name]||0}});Se(t);var d={Based:F.Based[a.name]||0,ALGO:F.Algo[a.name]||0,DATASET:F.Dataset[a.name]||0,Builder:F.Builder[a.name]||0,Validator:F.Validator[a.name]||0};at.current=d,K(!1)}},$t=function(){K(!1)};(0,c.useEffect)(function(){console.log("Updated baseContribution =",je)},[je]),(0,c.useEffect)(function(){le.current=je},[je]);var Xt=function(t){var d=at.current||t.contributions;Mt(!0),setTimeout(function(){va(t,d),Mt(!1),at.current=null},5e3)},va=function(t,d){var v=Wt(),j=t.name,f;if($e&&$e.trim()!=="")f=$e.trim(),Lt("");else{var m=Ct[Math.floor(Math.random()*Ct.length)];f=m}var b=Date.now()+6*60*60*1e3,A={nodeData:{nodeId:v,name:f,isNewNode:!0,endTime:b,contributions:d},children:[]};console.log("Creating new node:",{parentName:j,newNodeName:f,newNodeId:v,contributions:d});var U=JSON.parse(JSON.stringify(fe)),P=function R(X,Y){if(X.nodeData.name===Y)return X.children.push(A),console.log("Added new node to parent:",{parent:Y,newNode:A}),!0;for(var Q=0;Q<X.children.length;Q++)if(R(X.children[Q],Y))return!0;return!1},T=!1;if(U.forEach(function(R){P(R,j)&&(T=!0)}),!T){console.error("Can't find parent node: ".concat(j));return}sa(U);var E=y()(y()({},ae),{},q()({},f,{name:f,isNewNode:!0,contributions:d}));if(re(E),Fe.current+=1,i){var g=Ft(U),w=g.nodes,z=g.edges,G=w.find(function(R){return R.id===v});G&&(G.text.value=f),console.log("Transformed flow data:",{nodes:w,edges:z}),i.render({nodes:w,edges:z});var S=document.createElement("div");S.id="countdown-".concat(v),S.style.position="absolute",S.style.zIndex="1000",S.style.background="rgba(255, 255, 255, 0.9)",S.style.padding="2px 6px",S.style.borderRadius="10px",S.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.1)",S.style.display="flex",S.style.alignItems="center",S.style.fontSize="12px",S.style.color="#666666",S.style.pointerEvents="none";var H=document.createElement("span");H.innerHTML="training... (06:00:00)",S.appendChild(H),document.body.appendChild(S);var V=document.createElement("style");V.innerHTML=`
        @keyframes rotate {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }
      `,document.head.appendChild(V);var $=function R(){var X=Date.now(),Y=b-X;if(Y<=0){var Q=i.getNodeModelById(v);if(Q){Q.updateText(f);var de=Q.getProperties();Q.setProperties(y()(y()({},de),{},{isNewNode:!1,rawData:y()(y()({},de.rawData),{},{nodeData:y()(y()({},de.rawData.nodeData),{},{isNewNode:!1})})})),i.render(i.getGraphData())}return}var J=Math.floor(Y/(60*60*1e3)),De=Math.floor(Y%(60*60*1e3)/(60*1e3)),Pe=Math.floor(Y%(60*1e3)/1e3),ie="".concat(J.toString().padStart(2,"0"),":").concat(De.toString().padStart(2,"0"),":").concat(Pe.toString().padStart(2,"0")),me=i.getNodeModelById(v);me&&me.updateText("".concat(f,`
training... (`).concat(ie,")")),requestAnimationFrame(R)};setTimeout(function(){$()},500),i.on("transform",$),i==null||i.extension.dagre.layout({nodesep:15,ranksep:35})}wt(function(R){return[].concat(he()(R),[f])})};(0,c.useEffect)(function(){var h=y()({},ae),t=!1;fe.forEach(function(d){for(var v=[d];v.length>0;){var j=v.pop(),f=j.nodeData.name;if(f!==ue&&!ge.includes(f)){var m=nt(j.nodeData);h[f]=y()(y()({},h[f]),{},{contributions:m.contributions}),t=!0}}}),t&&(re(h),a&&a.name!==ue&&!ge.includes(a.name)&&Se(h[a.name]))},[je]),(0,c.useEffect)(function(){try{var h=localStorage.getItem("manuallyModifiedNodes");if(h){var t=JSON.parse(h);wt(t)}}catch(d){console.error("Failed to parse manuallyModifiedNodes from localStorage",d)}},[]),(0,c.useEffect)(function(){ge.length>0&&localStorage.setItem("manuallyModifiedNodes",JSON.stringify(ge))},[ge]);var xa=function(){return I?(0,e.jsx)(Qe.Z,{size:"small",title:(0,e.jsxs)("div",{style:{fontSize:"14px",fontWeight:600,color:"#1890ff",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:[(0,e.jsx)("span",{children:"Model Evolution"}),(0,e.jsx)(ne.ZP,{type:"text",icon:(0,e.jsx)(ht.Z,{}),size:"small",onClick:function(){return oe(!1)},style:{color:"#999",marginRight:"-8px"}})]}),style:{position:"absolute",bottom:"-19px",left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:"800px",minHeight:"120px",zIndex:1,borderRadius:"12px",boxShadow:"0 6px 16px rgba(0, 0, 0, 0.08)",backgroundColor:"#ffffff",border:"none"},bodyStyle:{padding:"12px 16px"},headStyle:{borderBottom:"1px solid #f0f0f0",padding:"8px 16px",minHeight:"32px"},children:(0,e.jsxs)(Sn.Z,{gutter:[16,8],children:[(0,e.jsx)(ut.Z,{span:16,children:(0,e.jsxs)(L.Z,{size:"small",column:1,labelStyle:{color:"#666",fontWeight:500,padding:"4px 0",fontSize:"13px"},contentStyle:{color:"#333",fontWeight:"normal",padding:"4px 0",fontSize:"13px"},children:[(0,e.jsx)(L.Z.Item,{label:"Model Name",children:a==null?void 0:a.name}),(0,e.jsx)(L.Z.Item,{label:"Model Algorithm",children:(0,e.jsxs)(D.Z,{defaultValue:"SFT",style:{width:"150px"},children:[(0,e.jsx)(D.Z.Option,{value:"SFT",children:"SFT"}),(0,e.jsx)(D.Z.Option,{value:"Algorithm 2",children:"Algorithm 2"}),(0,e.jsx)(D.Z.Option,{value:"Algorithm 3",children:"Algorithm 3"})]})}),(0,e.jsx)(L.Z.Item,{label:"Dataset",children:(0,e.jsxs)(D.Z,{defaultValue:"clinical-data-50k",style:{width:"150px"},children:[(0,e.jsx)(D.Z.Option,{value:"clinical-data-50k",children:"clinical-data-50k"}),(0,e.jsx)(D.Z.Option,{value:"dataset-100k",children:"dataset-100k"}),(0,e.jsx)(D.Z.Option,{value:"dataset-200k",children:"dataset-200k"})]})}),(0,e.jsx)(L.Z.Item,{label:"Builder",children:(0,e.jsxs)(D.Z,{mode:"multiple",defaultValue:["Alice","Bob"],style:{width:"100%"},children:[(0,e.jsx)(D.Z.Option,{value:"Alice",children:"Alice"}),(0,e.jsx)(D.Z.Option,{value:"Bob",children:"Bob"}),(0,e.jsx)(D.Z.Option,{value:"Charlie",children:"Charlie"}),(0,e.jsx)(D.Z.Option,{value:"David",children:"David"})]})})]})}),(0,e.jsxs)(ut.Z,{span:8,style:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"8px"},children:[(0,e.jsx)(ne.ZP,{type:"primary",size:"middle",style:{borderRadius:"6px",fontWeight:500,fontSize:"13px",height:"32px"},onClick:Gt,children:"Contribution Weight"}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px",position:"relative"},children:(0,e.jsxs)(ne.ZP,{type:"default",size:"middle",style:{flex:1,height:"32px",borderRadius:"6px",fontWeight:500,fontSize:"13px",borderColor:"#1890ff",color:Ne?"#ffffff":"#1890ff",position:"relative",overflow:"hidden",zIndex:1},onClick:function(){return Xt(a)},disabled:Ne,children:["Train",Ne&&(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#1890ff",zIndex:-1,animation:"fillAnimation 5s linear forwards"}})]})})]})]})}):null};(0,c.useEffect)(function(){Ce.current=ae},[]),(0,c.useEffect)(function(){JSON.stringify(Ce.current)!==JSON.stringify(ae)&&(Ce.current=y()({},ae))},[ae]);var ga=function(){var t=["Based","Algo","Dataset","Builder","Validator"],d=(0,c.useState)(F.Based[(a==null?void 0:a.name)||""]||0),v=Z()(d,2),j=v[0],f=v[1],m=function(g){var w=[],z=function(H){var V=it()(fe),$;try{for(V.s();!($=V.n()).done;)for(var R=$.value,X=[{node:R,path:[]}];X.length>0;){var Y=X.pop(),Q=Y.node,de=Y.path;if(Q.nodeData.name===H)return{found:!0,path:[].concat(he()(de),[H])};var J=it()(Q.children),De;try{for(J.s();!(De=J.n()).done;){var Pe=De.value;X.push({node:Pe,path:[].concat(he()(de),[Q.nodeData.name])})}}catch(ie){J.e(ie)}finally{J.f()}}}catch(ie){V.e(ie)}finally{V.f()}return{found:!1,path:[]}},G=z(g);return G.found?w.push.apply(w,he()(G.path)):w.push("base model"),w},b=function(g,w){var z=g.length,G=z<=1?5:Math.floor(5/(z-1));return g.map(function(S,H){return H===g.length-1?0:G})},A=function(g){if(!(a!=null&&a.name))return"";if(g!=="Based"){var w=F[g][a.name]||0;return"".concat(a.name," (").concat(w,"%)")}if(kt&&g==="Based")return kt;for(var z=m(a.name),G=z.length,S=[],H=Math.max.apply(Math,he()(z.map(function(Kt){return Kt.length})))+2,V=function(ma){for(var we=["Algo","Dataset","Builder","Validator"],ya=Math.max(0,ma),Ze=ya,Je={},ke=0;ke<we.length-1;ke++){if(Ze<=0){Je[we[ke]]=0;continue}var Ke=Math.max(0,Math.min(1,Ze)),ba=Math.max(Ke,Ze-(we.length-ke-1)*Ke),Ut=Math.floor(Math.random()*(ba-Ke+1))+Ke;Je[we[ke]]=Ut,Ze-=Ut}return Je[we[we.length-1]]=Math.max(0,Ze),Je},$=G-1;$>=0;$--){var R=z[$],X=void 0;if($===G-1)X=Math.max(0,j);else{var Y=S[0].match(/\((\d+)%\)/),Q=Y?parseInt(Y[1],10):0,de=Math.max(0,Math.min(8,Q));X=de>0?Math.floor(Math.random()*de)+1:0}var J=V(X),De=R.padEnd(H,""),Pe="".concat(De,"(").concat(X,"%)");if(S.push(Pe),$>0){var ie="   |   ";S.push("".concat(ie).concat(R,"-Algo:     ").concat(J.Algo,"%")),S.push("".concat(ie).concat(R,"-Dataset:  ").concat(J.Dataset,"%")),S.push("".concat(ie).concat(R,"-Builder:  ").concat(J.Builder,"%")),S.push("".concat(ie).concat(R,"-Validator:").concat(J.Validator,"%")),S.push("   |")}else{var me="       ";S.push("".concat(me).concat(R,"-Algo:     ").concat(J.Algo,"%")),S.push("".concat(me).concat(R,"-Dataset:  ").concat(J.Dataset,"%")),S.push("".concat(me).concat(R,"-Builder:  ").concat(J.Builder,"%")),S.push("".concat(me).concat(R,"-Validator:").concat(J.Validator,"%"))}}var Jt=S.join(`
`);return g==="Based"&&Ot(Jt),Jt},U=function(g,w){if(a!=null&&a.name){var z=m(a.name),G=b(z,w),S=G.reduce(function(V,$){return V+$},0);if(g>100-S){dt.ZP.error("Maximum available percentage is ".concat(100-S,"%"));return}var H=y()(y()({},F),{},q()({},w,y()(y()({},F[w]),{},q()({},a.name,g))));Et(H),w==="Based"&&(f(g),Ot(""),ra(function(V){return V+1}))}},P=function(){if(!(a!=null&&a.name))return 0;var g=0;return t.forEach(function(w){var z=m(a.name),G=b(z,w),S=G.reduce(function(H,V){return H+V},0);g+=S+(F[w][a.name]||0)}),g},T=P()===100;return(0,e.jsxs)("div",{style:{backgroundColor:"#fff",padding:"24px",borderRadius:"12px",width:"95%",maxWidth:"1200px",margin:"0 auto",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[(0,e.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[(0,e.jsx)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:t.map(function(E){return(0,e.jsx)("div",{style:{flex:1,textAlign:"center",fontWeight:"600",color:"#1f2937",fontSize:"14px",padding:"4px 12px",backgroundColor:E==="Based"?"#e3f2fd":"#e5e7eb",borderRadius:"16px",margin:"0 8px"},children:E},"title-".concat(E))})}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:t.map(function(E){return(0,e.jsx)("div",{style:{flex:1,textAlign:"center"},children:(0,e.jsx)(D.Z,{value:F[E][(a==null?void 0:a.name)||""]||0,onChange:function(w){return U(w,E)},style:{width:"80%",maxWidth:"120px"},bordered:!1,className:"contribution-select",children:Array.from({length:21},function(g,w){return w*5}).map(function(g){return(0,e.jsxs)(D.Z.Option,{value:g,children:[g,"%"]},g)})})},"select-".concat(E))})})]}),(a==null?void 0:a.name)!==ue&&(0,e.jsx)("div",{style:{padding:"20px",backgroundColor:"#f0f7ff",borderRadius:"12px",border:"1px solid #e6f0f9",marginBottom:"16px"},children:(0,e.jsx)("div",{style:{fontFamily:"Consolas, monospace",whiteSpace:"pre",color:"#374151",fontSize:"13px",lineHeight:"1.6",backgroundColor:"#fff",padding:"16px",borderRadius:"8px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:A("Based")})}),(0,e.jsxs)("div",{style:{padding:"12px",borderRadius:"8px",backgroundColor:T?"#f6ffed":"#fff1f0",border:"1px solid ".concat(T?"#b7eb8f":"#ffccc7"),display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsxs)("span",{style:{color:T?"#389e0d":"#cf1322",fontWeight:"500"},children:["Total: ",P(),"%"]}),!T&&(0,e.jsx)("span",{style:{color:"#cf1322",fontSize:"13px"},children:"Must be 100%"})]})]})},Za=function(){return(0,e.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",display:"flex",gap:"8px",zIndex:1},children:[!I&&(0,e.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(pt.Z,{}),onClick:function(){return oe(!0)},style:{borderRadius:"4px"},children:"Show Evolution"}),!Ge&&(0,e.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,e.jsx)(pt.Z,{}),onClick:function(){return et(!0)},style:{borderRadius:"4px"},children:"Show Details"})]})};return(0,c.useEffect)(function(){tt(!!Ge)},[Ge]),(0,e.jsxs)(tn._z,{pageHeaderRender:!1,childrenContentStyle:{padding:"0"},ghost:!0,className:"homeContent",style:{padding:"20px",background:"#f0f2f5"},children:[(0,e.jsx)("style",{children:`
          @keyframes fillAnimation {
            0% {
              transform: translateX(-100%);
            }
            100% {
              transform: translateX(0);
            }
          }
              background-position: 0 0;
            }
          }

          .train-button {
            background: linear-gradient(270deg, #1890ff, #1890ff);
            background-size: 200% 100%;
            animation: fillAnimation 5s linear forwards;
          }

          .contribution-select .ant-select-selector {
            background-color: #f8f9fa !important;
            border-radius: 4px !important;
            transition: all 0.3s !important;
          }
          
          .contribution-select:hover .ant-select-selector {
            background-color: #e9ecef !important;
          }
          
          .contribution-select .ant-select-selection-item {
            font-weight: 500 !important;
            color: #1f2937 !important;
            text-align: center !important;
          }

          @keyframes slideIn {
            from {
              transform: translateX(100%);
            }
            to {
              transform: translateX(0);
            }
          }
        `}),(0,e.jsx)("div",{className:nn.ModelFlow,ref:n}),(0,e.jsx)(Qe.Z,{title:(0,e.jsx)("div",{style:{fontSize:"16px",fontWeight:600,color:"#1a365d",textShadow:"0 1px 2px rgba(0,0,0,0.05)",padding:"4px 0",borderBottom:"2px solid rgba(24, 144, 255, 0.3)",marginBottom:"8px",display:"flex",justifyContent:"center"},children:"Info"}),size:"small",style:{position:"absolute",bottom:"10px",left:"10px",width:"800px",borderRadius:"16px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1), 0 2px 10px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(255, 255, 255, 0.2) inset",background:"linear-gradient(135deg, #f8faff, #e6f7ff)",padding:"16px",border:"none",backdropFilter:"blur(10px)",transform:"translateZ(0)",transition:"all 0.3s ease",overflow:"hidden"},headStyle:{borderBottom:"none",padding:"12px 16px 0",backgroundColor:"transparent"},bodyStyle:{padding:"8px 16px 16px"},children:(0,e.jsxs)(L.Z,{size:"small",column:5,colon:!1,children:[(0,e.jsx)(L.Z.Item,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:"140px",margin:"0 auto"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",color:"#2d3748",fontWeight:600},children:[(0,e.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#1890ff",marginRight:"8px",boxShadow:"0 0 4px #1890ff"}}),"Total Models"]}),(0,e.jsx)("div",{style:{color:"#1890ff",fontWeight:600,fontSize:"16px",textShadow:"0 0 1px rgba(24, 144, 255, 0.2)"},children:Fe.current})]})}),(0,e.jsx)(L.Z.Item,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:"140px",margin:"0 auto"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",color:"#2d3748",fontWeight:600},children:[(0,e.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#52c41a",marginRight:"8px",boxShadow:"0 0 4px #52c41a"}}),"Data Sets"]}),(0,e.jsx)("div",{style:{color:"#52c41a",fontWeight:600,fontSize:"16px",textShadow:"0 0 1px rgba(82, 196, 26, 0.2)"},children:x==null?void 0:x.DataSets})]})}),(0,e.jsx)(L.Z.Item,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:"140px",margin:"0 auto"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",color:"#2d3748",fontWeight:600},children:[(0,e.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#722ed1",marginRight:"8px",boxShadow:"0 0 4px #722ed1"}}),"Launched"]}),(0,e.jsx)("div",{style:{color:"#722ed1",fontWeight:600,fontSize:"16px",textShadow:"0 0 1px rgba(114, 46, 209, 0.2)"},children:x==null?void 0:x.LaunchedModels})]})}),(0,e.jsx)(L.Z.Item,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:"140px",margin:"0 auto"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",color:"#2d3748",fontWeight:600},children:[(0,e.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#fa8c16",marginRight:"8px",boxShadow:"0 0 4px #fa8c16"}}),"Validator"]}),(0,e.jsx)("div",{style:{color:"#fa8c16",fontWeight:600,fontSize:"16px",textShadow:"0 0 1px rgba(250, 140, 22, 0.2)"},children:x==null?void 0:x.Validator})]})}),(0,e.jsx)(L.Z.Item,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",width:"140px",margin:"0 auto"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",color:"#2d3748",fontWeight:600},children:[(0,e.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f5222d",marginRight:"8px",boxShadow:"0 0 4px #f5222d"}}),"Builder"]}),(0,e.jsx)("div",{style:{color:"#f5222d",fontWeight:600,fontSize:"16px",textShadow:"0 0 1px rgba(245, 34, 45, 0.2)"},children:x==null?void 0:x.Builder})]})})]})}),xa(),Ge&&(0,e.jsx)("div",{className:"node-details-container",style:{position:"absolute",top:"10px",right:"10px",width:"350px",height:"900px",zIndex:2,transition:"transform 0.3s ease-in-out",transform:ta?"translateX(0)":"translateX(100%)"},children:(0,e.jsxs)(Qe.Z,{size:"small",title:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsx)("span",{children:"Node Details"}),(0,e.jsx)(ne.ZP,{type:"text",icon:(0,e.jsx)(ht.Z,{}),size:"small",onClick:function(){tt(!1),setTimeout(function(){et(!1)},300)},style:{color:"#999"}})]}),style:{width:"100%",height:"100%",overflow:"auto",borderRadius:"12px",boxShadow:"0 6px 12px rgba(0, 0, 0, 0.15)",backgroundColor:"#ffffff",padding:"16px"},children:[fa(a),(0,e.jsx)("div",{style:{height:"250px",marginTop:"10px"},children:ha(a)}),(0,e.jsxs)("div",{style:{marginTop:"1px",paddingTop:"16px",textAlign:"center"},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"12px"},children:[(0,e.jsx)("hr",{style:{flex:1,border:"none",borderTop:"1px solid #f0f0f0",margin:"0 10px"}}),(0,e.jsx)("span",{style:{fontWeight:600,fontSize:"16px",color:"#333",whiteSpace:"nowrap"},children:"Evolution"}),(0,e.jsx)("hr",{style:{flex:1,border:"none",borderTop:"1px solid #f0f0f0",margin:"0 10px"}})]}),(0,e.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,e.jsx)("div",{style:{marginBottom:"4px",fontWeight:500,fontSize:"14px",color:"#333"},children:"New Model Name:"}),(0,e.jsx)(ct.Z,{placeholder:"Enter custom name (optional)",style:{width:"100%"},size:"small",onChange:function(t){return Lt(t.target.value)},value:$e})]}),(0,e.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,e.jsx)("div",{style:{marginBottom:"4px",fontWeight:500,fontSize:"14px",color:"#333"},children:"Model Algorithm:"}),(0,e.jsxs)(D.Z,{style:{width:"100%"},placeholder:"Select algorithm",defaultValue:(a==null?void 0:a.algorithm)||void 0,size:"small",children:[(0,e.jsx)(D.Z.Option,{value:"SFT",children:"SFT (Supervised Fine-Tuning)"}),(0,e.jsx)(D.Z.Option,{value:"RL",children:"RL (Reinforcement Learning)"}),(0,e.jsx)(D.Z.Option,{value:"RLHF",children:"RLHF (Reinforcement Learning from Human Feedback)"}),(0,e.jsx)(D.Z.Option,{value:"LoRA",children:"LoRA (Low-Rank Adaptation)"}),(0,e.jsx)(D.Z.Option,{value:"KTO",children:"KTO (KL-constrained Preference Optimization)"})]})]}),(0,e.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,e.jsx)("div",{style:{marginBottom:"4px",fontWeight:500,fontSize:"14px",color:"#333"},children:"Dataset:"}),(0,e.jsxs)(D.Z,{style:{width:"100%"},placeholder:"Select dataset",defaultValue:(a==null||(u=a.dataset)===null||u===void 0?void 0:u.id)||void 0,size:"small",children:[(0,e.jsx)(D.Z.Option,{value:"dataset1",children:"HandNet"}),(0,e.jsx)(D.Z.Option,{value:"dataset2",children:"MPI-INF-3DHP"}),(0,e.jsx)(D.Z.Option,{value:"dataset3",children:"VGG-Face2"}),(0,e.jsx)(D.Z.Option,{value:"dataset4",children:"InternVid"})]})]}),(0,e.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,e.jsx)("div",{style:{marginBottom:"4px",fontWeight:500,fontSize:"14px",color:"#333"},children:"Builder:"}),(0,e.jsxs)(D.Z,{style:{width:"100%"},placeholder:"Select builder",defaultValue:(a==null?void 0:a.builder)||void 0,size:"small",children:[(0,e.jsx)(D.Z.Option,{value:"builder1",children:"Team Alpha"}),(0,e.jsx)(D.Z.Option,{value:"builder2",children:"Team Beta"}),(0,e.jsx)(D.Z.Option,{value:"builder3",children:"Team Gamma"}),(0,e.jsx)(D.Z.Option,{value:"builder4",children:"Individual"})]})]}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px"},children:[(0,e.jsx)(ne.ZP,{type:"primary",size:"small",style:{borderRadius:"4px",backgroundColor:"#722ED1",borderColor:"#722ED1",height:"32px",fontWeight:500,fontSize:"13px"},icon:(0,e.jsx)(jn.Z,{}),onClick:Gt,children:"Contribution"}),(0,e.jsxs)(ne.ZP,{type:"default",size:"small",style:{height:"32px",borderRadius:"6px",fontWeight:500,fontSize:"13px",borderColor:"#1890ff",color:Ne?"#ffffff":"#1890ff",position:"relative",overflow:"hidden",zIndex:1},onClick:function(){return Xt(a)},disabled:Ne,children:["Train",Ne&&(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#1890ff",zIndex:-1,animation:"fillAnimation 5s linear forwards"}})]})]})]})]})}),(0,e.jsxs)(ft.Z,{title:(0,e.jsxs)("div",{style:{fontSize:"16px",fontWeight:500,color:"#1890ff"},children:[(0,e.jsx)("div",{children:a==null?void 0:a.name}),"Contribution Weight"]}),visible:ce,onOk:Ht,onCancel:$t,width:900,centered:!0,bodyStyle:{padding:"16px"},style:{borderRadius:"12px",overflow:"hidden"},footer:(0,e.jsxs)("div",{style:{padding:"12px 12px",borderTop:"1px solid #f0f0f0",display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,e.jsx)(ne.ZP,{onClick:$t,children:"Cancel"}),(0,e.jsx)(ne.ZP,{type:"primary",onClick:Ht,children:"Confirm"})]}),children:[(0,e.jsx)("div",{style:{marginBottom:"5px",color:"#666"},children:"Total must be 100%"}),(0,e.jsx)(ga,{})]}),(0,e.jsx)(Gn,{show:Le.showModel,data:Le.data,onClose:function(){We({showModel:!1,data:{}})}})]})},Xn=$n}}]);
